[{"id":"e0836e2.ec5a99","type":"tab","label":"EasyPark Databases"},{"id":"15441c32.511794","type":"tab","label":"EasyPark Balise"},{"id":"6763e472.c37e3c","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":""},{"id":"2ac9c083.b39b1","type":"influxdb","z":"15441c32.511794","hostname":"127.0.0.1","port":"8086","database":"EasyPark","name":"NodesLog"},{"id":"b1651725.98f8d8","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","newline":"50","bin":"false","out":"time","addchar":false},{"id":"3fd166c7.929b1a","type":"mqtt-broker","z":"","broker":"test.mosquitto.org","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"ab9fcd72.79f54","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"EasyPark","name":"NodesLog"},{"id":"fd42ff10.6eb0b","type":"mongodb2","z":"","uri":"mongodb://127.0.0.1:27017","name":"easypark_nodes","options":"","parallelism":""},{"id":"dbc084c6.658ff8","type":"mongodb2","z":"","uri":"","name":"","options":"","parallelism":""},{"id":"1594f6ec.82ed09","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"easypark_nodes","name":""},{"id":"732c7048.d0685","type":"debug","z":"15441c32.511794","name":"","active":true,"console":"false","complete":"payload","x":740.2000122070312,"y":74.19999694824219,"wires":[]},{"id":"c81b177f.743978","type":"mqtt out","z":"15441c32.511794","name":"","topic":"","qos":"0","retain":"false","broker":"6763e472.c37e3c","x":751.1999664306641,"y":203.1999969482422,"wires":[]},{"id":"730ec48c.958e9c","type":"serial in","z":"15441c32.511794","name":"XBee Input","serial":"b1651725.98f8d8","x":96.5,"y":182.1999938964844,"wires":[["d577b7c1.e32508","e04ee7dd.681ee8"]]},{"id":"d577b7c1.e32508","type":"function","z":"15441c32.511794","name":"MsgTreat","func":"//slpit the msg\nvar FT, NB, SID, WID, FSeq, S1, S2, S3, S4, S5;\nvar MODE, PS, MF, MFX, MFY, MFZ, TEMP, BAT;\nvar outputMsgs = {};\nvar sensors = msg.payload.split(\"#\");\nvar i = 0;\n\nfor (var w in sensors) {\n    switch(i)\n    {\n        case 0:\n            FT = sensors[w];\n            break;\n        case 1:\n            SID = sensors[w];\n            break;\n        case 2:\n            WID = sensors[w];\n            break;\n        case 3:\n            FSeq = sensors[w];\n            break;\n        case 4:\n            S1 = sensors[w];\n            MODE = S1.split(\":\")[1];\n            break;\n        case 5:\n            S2 = sensors[w];\n            PS = parseInt(S2.split(\":\")[1]);\n            break;\n        case 6:\n            S3 = sensors[w];\n            MF = S3.split(\":\")[1];\n            MFX = parseInt(MF.split(\";\")[0]);\n            MFY = parseInt(MF.split(\";\")[1]);\n            MFZ = parseInt(MF.split(\";\")[2]);\n            break;\n        case 7:\n            S4 = sensors[w];\n            TEMP = parseInt(S4.split(\":\")[1]);\n            break;\n        case 8:\n            S5 = sensors[w];\n            BAT = parseInt(S5.split(\":\")[1]);\n            break;\n        default:\n    }\n    i++;\n}\n\noutputMsgs.payload = [  {\n                            ps : PS,\n                            mfx : MFX,\n                            mfy : MFY,\n                            mfz : MFZ,\n                            temp : TEMP, \n                            bat : BAT,\n                        },\n                        {\n                            wid : WID,\n                            mode : MODE\n                        }];\n\noutputMsgs.topic = \"easypark/esigelec/\" + WID;\nreturn [outputMsgs];","outputs":1,"noerr":0,"x":385.69993591308594,"y":175.20000457763672,"wires":[["c81b177f.743978","732c7048.d0685"]]},{"id":"b3de86d0.e4aae8","type":"inject","z":"15441c32.511794","name":"","topic":"","payload":"<=>ï¿½\u0004#408415792#N01#1#STR:normal#PS:0#MF:361;781;513#IN_TEMP:23#BAT:40#","payloadType":"str","repeat":"","crontab":"","once":false,"x":104.50001525878906,"y":129.80001831054688,"wires":[["d577b7c1.e32508"]]},{"id":"52012c0.efffdd4","type":"mqtt in","z":"e0836e2.ec5a99","name":"","topic":"easypark/#","qos":"0","broker":"6763e472.c37e3c","x":65,"y":292.20001220703125,"wires":[["14282833.74cf88"]]},{"id":"d05efb82.49c778","type":"influxdb out","z":"e0836e2.ec5a99","influxdb":"ab9fcd72.79f54","name":"","measurement":"ps","x":631.3000640869141,"y":212.400146484375,"wires":[]},{"id":"14282833.74cf88","type":"json","z":"e0836e2.ec5a99","name":"","x":235.30001831054688,"y":288.8001251220703,"wires":[["d05efb82.49c778","b50645dd.bb7d38"]]},{"id":"e04ee7dd.681ee8","type":"debug","z":"15441c32.511794","name":"","active":true,"console":"false","complete":"false","x":354.50001525878906,"y":311.40000915527344,"wires":[]},{"id":"7ef9d379.1305bc","type":"mongodb out","z":"e0836e2.ec5a99","mongodb":"1594f6ec.82ed09","name":"update","collection":"esigelec","payonly":false,"upsert":false,"multi":false,"operation":"update","x":762.5000152587891,"y":359.40003967285156,"wires":[]},{"id":"b50645dd.bb7d38","type":"function","z":"e0836e2.ec5a99","name":"MongoDB_update","func":"var newMsg = {};\nnewMsg.query = { '_id' : msg.payload[1].wid };\nnewMsg.payload = { $set:\n                    {\n                        'ps' : msg.payload[0].ps,\n                        'bat': msg.payload[0].bat\n                    } \n                 };\nnewMsg.limit = 1;\nnewMsg.skip = 0;\nreturn newMsg;","outputs":1,"noerr":0,"x":572.2000274658203,"y":354.2000274658203,"wires":[["7ef9d379.1305bc"]]}]