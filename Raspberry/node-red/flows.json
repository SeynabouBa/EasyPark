[{"id":"15441c32.511794","type":"tab","label":"EasyPark Balise"},{"id":"e0836e2.ec5a99","type":"tab","label":"EasyPark Database"},{"id":"6763e472.c37e3c","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":""},{"id":"2ac9c083.b39b1","type":"influxdb","z":"15441c32.511794","hostname":"127.0.0.1","port":"8086","database":"EasyPark","name":"NodesLog"},{"id":"b1651725.98f8d8","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","newline":"10","bin":"false","out":"time","addchar":false},{"id":"3fd166c7.929b1a","type":"mqtt-broker","z":"","broker":"test.mosquitto.org","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"732c7048.d0685","type":"debug","z":"15441c32.511794","name":"","active":true,"console":"false","complete":"payload","x":740.2000122070312,"y":74.19999694824219,"wires":[]},{"id":"c81b177f.743978","type":"mqtt out","z":"15441c32.511794","name":"","topic":"","qos":"0","retain":"false","broker":"6763e472.c37e3c","x":751.1999664306641,"y":203.1999969482422,"wires":[]},{"id":"730ec48c.958e9c","type":"serial in","z":"15441c32.511794","name":"XBee Input","serial":"b1651725.98f8d8","x":96.5,"y":182.1999938964844,"wires":[["d577b7c1.e32508"]]},{"id":"d577b7c1.e32508","type":"function","z":"15441c32.511794","name":"MsgTreat","func":"//slpit the msg\nvar FT, NB, SID, WID, FSeq, S1, S2, S3, S4, S5;\nvar MODE, PS, MF, MFX, MFY, MFZ, TEMP, BAT;\nvar outputMsgs = {};\nvar sensors = msg.payload.split(\"#\");\nvar i = 0;\n\nfor (var w in sensors) {\n    switch(i)\n    {\n        case 0:\n            FT = sensors[w];\n            break;\n        case 1:\n            SID = sensors[w];\n            break;\n        case 2:\n            WID = sensors[w];\n            break;\n        case 3:\n            FSeq = sensors[w];\n            break;\n        case 4:\n            S1 = sensors[w];\n            MODE = S1.split(\":\")[1];\n            break;\n        case 5:\n            S2 = sensors[w];\n            PS = parseInt(S2.split(\":\")[1]);\n            break;\n        case 6:\n            S3 = sensors[w];\n            MF = S3.split(\":\")[1];\n            MFX = parseInt(MF.split(\";\")[0]);\n            MFY = parseInt(MF.split(\";\")[1]);\n            MFZ = parseInt(MF.split(\";\")[2]);\n            break;\n        case 7:\n            S4 = sensors[w];\n            TEMP = parseInt(S4.split(\":\")[1]);\n            break;\n        case 8:\n            S5 = sensors[w];\n            BAT = parseInt(S5.split(\":\")[1]);\n            break;\n        default:\n    }\n    i++;\n}\n\noutputMsgs.payload = [  {\n                            ps : PS,\n                            mfx : MFX,\n                            mfy : MFY,\n                            mfz : MFZ,\n                            temp : TEMP, \n                            bat : BAT,\n                        },\n                        {\n                            wid : WID,\n                            mode : MODE\n                        }];\n\noutputMsgs.topic = \"easypark/esigelec/\" + WID;\nreturn [outputMsgs];","outputs":1,"noerr":0,"x":385.69993591308594,"y":175.20000457763672,"wires":[["c81b177f.743978","732c7048.d0685"]]},{"id":"b3de86d0.e4aae8","type":"inject","z":"15441c32.511794","name":"","topic":"","payload":"<=>ï¿½\u0004#408415792#N01#1#PS:1#MF:361;781;513#IN_TEMP:23#BAT:40#","payloadType":"str","repeat":"","crontab":"","once":false,"x":104.50001525878906,"y":129.80001831054688,"wires":[["d577b7c1.e32508"]]},{"id":"52012c0.efffdd4","type":"mqtt in","z":"e0836e2.ec5a99","name":"","topic":"easypark/#","qos":"0","broker":"6763e472.c37e3c","x":220.1999969482422,"y":186.1999969482422,"wires":[["14282833.74cf88","34a4d55a.d6126a"]]},{"id":"d3540903.6a1828","type":"inject","z":"e0836e2.ec5a99","name":"find","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":104.19996643066406,"y":327.00009536743164,"wires":[["1a8b3344.b17dad"]]},{"id":"90856176.522d5","type":"debug","z":"e0836e2.ec5a99","name":"","active":true,"console":"false","complete":"payload","x":796.1999816894531,"y":320.6002540588379,"wires":[]},{"id":"1a8b3344.b17dad","type":"function","z":"e0836e2.ec5a99","name":"simple query","func":"msg.query=\"select * from ps;\";\nreturn msg;","outputs":1,"noerr":0,"x":312.1999816894531,"y":309.00009536743164,"wires":[["f040291.01939d8"]]},{"id":"d05efb82.49c778","type":"influxdb out","z":"e0836e2.ec5a99","influxdb":"2ac9c083.b39b1","name":"","measurement":"ps","x":857.3000335693359,"y":152.400146484375,"wires":[]},{"id":"f040291.01939d8","type":"influxdb in","z":"e0836e2.ec5a99","influxdb":"2ac9c083.b39b1","name":"","query":"","x":597.3000030517578,"y":327.2001190185547,"wires":[["90856176.522d5"]]},{"id":"14282833.74cf88","type":"json","z":"e0836e2.ec5a99","name":"","x":479.3000030517578,"y":176.80010986328125,"wires":[["d05efb82.49c778"]]},{"id":"34a4d55a.d6126a","type":"debug","z":"e0836e2.ec5a99","name":"","active":true,"console":"false","complete":"payload","x":461.30003356933594,"y":63.60009765625,"wires":[]}]